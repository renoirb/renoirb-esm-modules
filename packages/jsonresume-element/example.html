<!DOCTYPE html>
<html lang="en-CA" class="layout--default zone__sandwich light-mode">
  <head>
    <!--


    Example of a Resume leveraging features from this package.


    -->
    <script type="module">
      import { ContextRoot } from '@renoirb/context-api'
      new ContextRoot().attach(document.body)
    </script>
    <script
      type="module"
      src="http://localhost:8000/packages/value-date-element/example-context-api.mjs?setup&delay"
    ></script>
    <script
      type="module"
      src="http://localhost:8000/packages/markdown-content-element/example-context-api.mjs?setup&delay"
    ></script>
  </head>
  <body>
    <app-layout class="nuxt-content">
      <div class="document document--item">
        <app-notice variant="info">
          <strong slot="header">Work In Progress</strong>
          <p>
            This version is meant to allow visualizing the
            <abbr>YAML</abbr> into a fully functional, curriculum vitae and
            it'll be hosted at
            <a href="https://renoirboulanger.com/resume/as-code/"
              >https://renoirboulanger.com/resume/</a
            >
          </p>
        </app-notice>

        <div class="body">
          <app-jsonresume>
            <div id="work-experience" slot="work-experience">
              <app-work-experience
                data-entity-name="Self-Employed"
                data-position-title="Open Source Web Components Specialist (part time)"
                data-date-begin="2024-09-01"
                data-entity-url="https://renoirb.com"
              >
                Lorem ipsum dolor sit amet, consectetur adipiscing elit.
              </app-work-experience>
              <app-notice variant="error">Something did not work, that section should be replaced.</app-notice>
            </div>
          </app-jsonresume>
        </div>
      </div>

      <div slot="top-right"></div>
    </app-layout>

    <script type="module">
      import AppLayoutElement from '@renoirb/app-layout-element'

      import {
        ValueDateRangeElement,
        ValueDateElement,
      } from '@renoirb/value-date-element'
      import { NoticeBoxElement } from '@renoirb/notice-box-element'
      import { MarkdownContentElement } from '@renoirb/markdown-content-element'
      import {
        JsonResumeElement,
        WorkExperienceElement,
      } from '@renoirb/jsonresume-element'
      customElements.define('app-layout', AppLayoutElement)
      customElements.define('app-notice', NoticeBoxElement)
      customElements.define('value-date', ValueDateElement)
      customElements.define('value-date-range', ValueDateRangeElement)
      customElements.define('app-work-experience', WorkExperienceElement)
      customElements.define('app-jsonresume', JsonResumeElement)
      customElements.define('un-markdown', MarkdownContentElement)
    </script>

    <script type="module">
      import { ContextProviderEvent } from '@renoirb/context-api'
      import { getJsonResumeOverrideWith } from '@renoirb/jsonresume-utils'

      // 'https://gist.githubusercontent.com/renoirb/3994ca5b50f9ad1ef2d794476b459c27/raw/jsonresume-overrides.yaml'

      // export const URL_JSON_RESUME_DEFAULT_YAML = 'https://raw.githubusercontent.com/renoirb/site/refs/heads/2020/content/resume/jsonresume-renoirb.yaml'
      // https://renoirboulanger.com/files/resume/jsonresume-renoirb.json

      let URL_JSON_RESUME =
        'https://raw.githubusercontent.com/renoirb/site/refs/heads/2020/content/resume/jsonresume-renoirb.yaml'

      URL_JSON_RESUME = 'https://gist.githubusercontent.com/renoirb/3994ca5b50f9ad1ef2d794476b459c27/raw/jsonresume-overrides.yaml'

      ;(async function init() {
        const [_, __, resumeData] = await Promise.all([
          customElements.whenDefined('app-jsonresume'),
          customElements.whenDefined('app-work-experience'),
          getJsonResumeOverrideWith(URL_JSON_RESUME),
        ])


        const targetEl = document.querySelector('app-jsonresume')
        const targetInnerEl = document.getElementById('work-experience')
        targetInnerEl.innerHTML = ''

        document.addEventListener('context-request', (event) => {
          if (event.context === 'jsonresume-basics') {
            event.stopPropagation();
            event.callback(resumeData.basics || {});
          }
        });
        // Announce provider is ready - this triggers replay!
        document.body.dispatchEvent(
          new ContextProviderEvent('jsonresume-basics', document.body)
        );

        let el = document.createElement('app-work-experience')

        // by hand
        // let el = document.createElement('app-work-experience')
        // el.setAttribute('data-entity-name', 'Renoir Boulanger')
        // el.setAttribute('data-position-title', 'Self Employed')
        // el.setAttribute('data-date-begin', '2024-09-01')
        // el.setAttribute('data-entity-url', 'https://renoirb.com')
        // targetInnerEl.appendChild(el)

        // Iterate
        for (const experience of resumeData?.work) {
          const {
            company = '',
            endDate = '',
            startDate = '',
            url,
            position = '',
            summary,
            description,
            highlights = [],
          } = experience
          el = document.createElement('app-work-experience')
          el.setAttribute('data-entity-name', company)
          el.setAttribute('data-position-title', position)
          el.setAttribute('data-date-begin', startDate)
          el.setAttribute('data-date-end', endDate)
          if (url) {
            el.setAttribute('data-entity-url', url)
          }
          if (summary) {
            el.innerHTML = `<p>${summary}</p>`
          }
          targetInnerEl.appendChild(el)
          if (highlights && highlights.length > 0) {
            const summaryDetailsEl = document.createElement('summary')
            const umd = document.createElement('un-markdown')
            umd.setAttribute('data-transition', 'spinner')
            umd.innerHTML = `${highlights.map((i) => '- ' + i).join('\n')}\n`
            targetInnerEl.appendChild(umd)
          }
        }
      })()
    </script>
    <style>
      :not(:defined),
      workbench-nav {
        display: none;
      }
      app-jsonresume::part(work) {
        font-size: 1em;
      }
      app-work-experience::part(experience-header) {
        font-size: 1.2em;
      }
    </style>
  </body>
</html>
